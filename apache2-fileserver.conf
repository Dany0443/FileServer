
<VirtualHost *:80>
    ServerName webjuniors.team
    ServerAlias www.webjuniors.team

    Alias "/static/" "/mnt/hdd/storage/"
    <Directory "/mnt/hdd/storage/">
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
        EnableSendfile On
        Header set Cache-Control "public, max-age=31536000"
    </Directory>

    ProxyPreserveHost On
    ProxyPass "/api/" "http://localhost:3445/api/"
    ProxyPassReverse "/api/" "http://localhost:3445/api/"

    # Optional: Proxy WebSocket if needed
    # ProxyPass "/socket.io/" "ws://localhost:3000/socket.io/"
    # ProxyPassReverse "/socket.io/" "ws://localhost:3000/socket.io/"

    <IfModule mod_headers.c>
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
        Header always set Access-Control-Allow-Headers "X-Requested-With, Content-Type, Authorization, x-auth-token"
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-Content-Type-Options "nosniff"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
        Header always set Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; object-src 'none'; frame-ancestors 'self'; base-uri 'self'; form-action 'self';"
        Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    </IfModule>
</VirtualHost>

<VirtualHost *:443>
    Protocols h2 http/1.1
    ServerName webjuniors.team
    ServerAlias www.webjuniors.team

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/webjuniors.team.crt
    SSLCertificateKeyFile /etc/ssl/private/webjuniors.team.key
    # Optional: SSLCertificateChainFile /etc/ssl/certs/chain.crt

    Alias "/static/" "/mnt/hdd/storage/"
    <Directory "/mnt/hdd/storage/">
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
        EnableSendfile On
        Header set Cache-Control "public, max-age=31536000"
    </Directory>

    ProxyPreserveHost On
    ProxyPass "/api/" "http://localhost:3445/api/"
    ProxyPassReverse "/api/" "http://localhost:3445/api/"

    # Optional: Proxy WebSocket if needed
    # ProxyPass "/socket.io/" "ws://localhost:3000/socket.io/"
    # ProxyPassReverse "/socket.io/" "ws://localhost:3000/socket.io/"

    <IfModule mod_headers.c>
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
        Header always set Access-Control-Allow-Headers "X-Requested-With, Content-Type, Authorization, x-auth-token"
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-Content-Type-Options "nosniff"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
        Header always set Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; object-src 'none'; frame-ancestors 'self'; base-uri 'self'; form-action 'self';"
        Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    </IfModule>
</VirtualHost>